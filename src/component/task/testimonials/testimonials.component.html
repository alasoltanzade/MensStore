<div class="all-contain position-relative w-100" style="overflow: auto; min-height: 100vh;">

  <app-header></app-header>

  <div class="bg-container bg-img">
  </div>

  <div class="container">

    <div class="row" *ngIf="!isLoading">
      <div class="col-12 text-center">
        <div class="sort-div">
          <label for="sortByDate">مرتب سازی بر اساس تاریخ:</label>
          <select id="sortByDate" (change)="sortPosts($any($event.target).value)">
            <option value="new">جدید ترین پست</option>
            <option value="old">قدیمی ترین پست</option>
          </select>
        </div>
        <input type="text" class="form-control" id="searchInput" placeholder="جست و جو..."
          (input)="searchPosts($any($event.target).value)" />

        <div class="categories-container">
          <div *ngFor="let category of getCategories()" class="category-section">
            <h2 class="category-title">{{ category }}</h2>
            <div class="products-grid">
              <div *ngFor="let post of getPostsByCategory(category)" class="product-card">
                <div class="product-image-wrapper">
                  <img *ngIf="post.imageUrl" [src]="post.imageUrl" class="product-image" alt="{{ post.instrument }}" />
                  <div *ngIf="!post.imageUrl" class="product-image-placeholder">
                    <span>بدون تصویر</span>
                  </div>
                </div>

                <div class="product-info">
                  <h3 *ngIf="editingPostId !== post.id" class="product-title">{{ post.instrument }}</h3>
                  <input *ngIf="editingPostId === post.id" type="text" class="form-control mb-2"
                    [(ngModel)]="tempPost.instrument" />

                  <p *ngIf="editingPostId !== post.id" class="product-description">{{ post.description }}</p>
                  <textarea *ngIf="editingPostId === post.id" class="form-control mb-2" rows="3"
                    [(ngModel)]="tempPost.description"></textarea>

                  <div class="product-price">
                    <span *ngIf="editingPostId !== post.id" class="price-label">قیمت: </span>
                    <span *ngIf="editingPostId !== post.id" class="price-value">{{ post.year | number }} تومان</span>
                    <div *ngIf="editingPostId === post.id" class="form-group w-100 mb-2">
                      <input type="number" class="form-control" placeholder="قیمت (تومان)"
                        [(ngModel)]="tempPost.year" />
                    </div>
                  </div>

                  <div class="product-date">
                    <span>{{ post.date | date:'short' }}</span>
                  </div>

                  <div class="product-actions" *ngIf="isPostOwner(post)">
                    <button *ngIf="editingPostId !== post.id" class="btn-action btn-edit" (click)="startEditing(post)">
                      ویرایش
                    </button>

                    <button *ngIf="editingPostId === post.id" class="btn-action btn-save" (click)="saveEdit()">
                      ذخیره
                    </button>

                    <button *ngIf="editingPostId === post.id" class="btn-action btn-cancel" (click)="cancelEdit()">
                      لغو
                    </button>

                    <button *ngIf="editingPostId !== post.id" class="btn-action btn-delete"
                      (click)="deletePost(post.id)">
                      حذف
                    </button>
                  </div>
                </div>
              </div>

              <div *ngIf="getPostsByCategory(category).length === 0" class="empty-category">
                <p>هیچ محصولی در این دسته‌بندی وجود ندارد</p>
              </div>
            </div>
          </div>

          <div *ngIf="getCategories().length === 0 && displayedPosts.length === 0" class="alert alert-info mt-4">
            هیچ پستی یافت نشد. اولین نفری باشید که محصول اضافه می‌کند!
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-footer></app-footer>
</div>